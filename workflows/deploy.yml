steps:
- id: build-img
  uses: docker://docker:19.03.10
  args: [build, --tag, mldashboard, .]

- id: stop
  uses: docker://docker:19.03.10
  runs: [sh, -c, 'docker stop dash || true']

- id: init-db
  uses: docker://mldashboard
  skip_pull: true
  env:
    FLASK_APP: /workspace/app/__init__.py
  runs: [flask, fab, create-admin]

- id: start
  uses: docker://docker:19.03.10
  args:
  - run
  -  --rm
  -  --detach
  -  --name=dash
  -  --env=FLASK_APP=/workspace/app/__init__.py
  -  --env=FLASK_CONFIG=/workspace/app/config.py
  -  --publish=80:80
  -  mldashboard
